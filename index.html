<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>Jogo da Mem√≥ria</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Schoolbell&display=swap");

      :root {
        /* üîπ Tamanhos */
        --card-size-h: 23vh;
        --card-size-w: calc(var(--card-size-h) / 1.39);
        --logo-w: 12vw;
        --logo-h: auto;

        /* üîπ Cores principais */
        --color-red-bg: #c9362d;
        --color-green-bg: #a8bd47;
        --color-red-apple: #c41710;

        --color-book-red: #c4362d;
        --color-book-green: #a9bc39;
        --color-book-page: #f3d6af;

        --color-fiap-red: #f90667;
        --color-fiap-green: #37c8b7;
        --color-fiap-greencian: #29f4d5;
        --color-fiap-yellow: #fff52a;

        /* üîπ Timer */
        --timer-arc-bg: #00000000;
        --timer-center-bg: #ffffff00;
        --timer-color-text: #000000;

        /* üîπ Timer estados */
        --timer-default: #10b981;
        --timer-warning: #f8cb15;
        --timer-alert: #ef4444;

        /* üîπ Transi√ß√£o */
        --transition-speed: 2s;
      }

      body {
        font-family: "Schoolbell", sans-serif;
        user-select: none; /* Desativa a sele√ß√£o de texto */
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        touch-action: manipulation; /* Desativa pin√ßa de zoom */
      }

      /* Cartas */
      .card-inner {
        transform-style: preserve-3d;
        transition: transform 0.6s;
        position: relative;
      }
      .card.flipped .card-inner {
        transform: rotateY(180deg);
      }
      .card-front,
      .card-back {
        position: absolute;
        width: 100%;
        height: 100%;
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .card-front {
        background-image: url("assets/verso.png");
        background-size: cover;
        background-position: center;
      }
      .card-back {
        transform: rotateY(180deg);
      }
      .card {
        width: var(--card-size-w);
        height: var(--card-size-h);
      }
      #game-logo img {
        width: var(--logo-w);
        height: var(--logo-h);
      }
      .timer-circle {
        transform: rotate(-90deg);
      }
      .timer-path-remaining {
        stroke-linecap: round;
      }

      /* üîπ Transi√ß√£o Fade + Zoom */
      .page-transition {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.95);
        opacity: 0;
        width: 70%;
        height: 60%;
        transition: opacity 0.8s ease, transform 0.8s ease;
        pointer-events: none;
      }

      .page-transition.active {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
        pointer-events: auto;
        z-index: 20;
      }
    </style>
  </head>
  <body class="h-screen w-screen flex items-center justify-center overflow-hidden">
    <img src="/assets/background2.png" alt="Imagem de fundo" class="z-0 absolute inset-0 h-full w-full bg-contain" />

    <!-- üîπ Container -->
    <div id="screens-container" class="relative w-full h-full flex items-center justify-center">
      <!-- Tela Inicial -->
      <div
        id="start-screen"
        class="w-[70%] h-[65%] page-transition active bg-purple-600/70 border-4 border-slate-900 rounded-[70px] drop-shadow-2xl flex flex-col items-center justify-center gap-6"
      >
        <img src="assets/logo.png" alt="Logo FIAP School" class="h-28 w-auto mb-4" />
        <p class="tracking-wider text-4xl text-center text-gray-900 mb-4">Ajude A <strong class="text-4xl">FAM√çLIA GORGONZOLA </strong> encontrar os seus pares no...</p>
        <h1 class="text-6xl font-bold text-gray-900 mb-4">Jogo da Mem√≥ria</h1>
        <button
          id="start-button"
          class="bg-yellow-500/70 border-2 border-gray-900 text-black font-bold tracking-[3px] mt-10 py-4 px-10 rounded-[30px] text-3xl hover:bg-green-400 hover:text-black transition-all duration-300 transform hover:scale-105"
        >
          VAMOS JOGAR!
        </button>
      </div>

      <!-- Tela Final -->
      <div
        id="final-screen"
        class="w-[70%] h-[65%] page-transition bg-yellow-300 border-4 border-slate-900 rounded-[70px] drop-shadow-2xl flex flex-col items-center justify-center gap-6"
      >
        <img src="assets/logo.png" alt="Logo FIAP School" class="h-28 w-auto mb-4" />
        <p class="tracking-wider text-4xl text-center text-gray-900 mb-4"><strong>Muito Obrigado pela ajuda...</strong></p>
        <h1 id="final-message" class="text-5xl font-bold text-gray-900 mb-4"></h1>
      </div>

      <!-- Tela do Jogo -->
      <div id="game-wrapper" class="page-transition w-full h-full flex">
        <img src="assets/background2.png" class="z-10 absolute inset-0 h-full w-full bg-contain" alt="background" />

        <div id="itens-esquerda" class="h-screen flex-1 flex flex-col items-center justify-center">
          <div id="game-logo" class="z-20 h-[30%] w-full flex items-end justify-center">
            <img src="assets/logo.png" alt="Logo do Jogo" />
          </div>
          <div id="game-space-l2" class="h-[40%] w-full flex items-center justify-center"></div>
          <div id="game-pares" class="z-20 h-[30%] w-full flex flex-col items-center justify-start font-bold">
            <span class="uppercase text-stone-900 text-6xl">PARES</span>
            <span class="uppercase text-stone-900 text-2xl">ENCONTRADOS:</span>
            <span id="pares-count" class="text-8xl text-stone-900 mt-2">0</span>
          </div>
        </div>

        <div id="game-container" class="w-fit h-screen p-8 flex items-center justify-center">
          <div id="game-grid" class="z-20 grid grid-cols-6 gap-2"></div>
        </div>

        <div id="itens-direita" class="h-screen flex-1 flex flex-col items-center justify-center">
          <div id="game-space-r1" class="h-[30%] z-20 w-full flex items-center justify-center"></div>

          <div id="game-time" class="h-[40%] z-20 w-full flex items-center justify-center">
            <div class="relative w-40 h-40">
              <svg class="w-full h-full timer-circle" viewBox="0 0 100 100">
                <circle id="timer-bg" stroke-width="8" fill="transparent" r="45" cx="50" cy="50" stroke="var(--timer-arc-bg)" />
                <path
                  id="timer-path-remaining"
                  stroke-width="8"
                  fill="transparent"
                  d="M 50, 50
                  m -45, 0
                  a 45,45 0 1,0 90,0
                  a 45,45 0 1,0 -90,0"
                ></path>
                <circle id="timer-center" r="35" cx="50" cy="50" fill="var(--timer-center-bg)"></circle>
              </svg>
              <span id="time-left" class="absolute inset-0 flex items-center justify-center text-5xl font-bold text-stone-900"></span>
            </div>
            <span id="end-message" class="hidden absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-2xl font-bold text-gray-900"></span>
          </div>

          <div id="game-space-r3" class="h-[30%] w-full flex items-center justify-center"></div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        /* ===========================================================
       üîπ CONFIGURA√á√ïES PERSONALIZ√ÅVEIS
       =========================================================== */
        const CONFIG = {
          // ‚è≥ Timer do jogo
          TIME_LIMIT: 45, // tempo total de jogo (segundos)
          WARNING_THRESHOLD: 10, // quando mudar para cor de aviso
          ALERT_THRESHOLD: 5, // quando mudar para cor de alerta

          // üé¥ Cartas
          PREVIEW_DURATION: 6000, // tempo que as cartas ficam viradas no in√≠cio (ms)

          // üìÑ Telas
          FINAL_SCREEN_DURATION: 15000, // tempo que a tela final permanece (ms)
          TRANSITION_DURATION: 800, // tempo da transi√ß√£o Fade+Zoom entre telas (ms)

          // üîä Sons
          VOLUME: 0.5, // Volume padr√£o para todos os sons
        };

        // Configura√ß√µes de volume individuais para cada som
        const AUDIO_VOLUMES = {
          startScreen: 0.3,
          playButton: 0.8,
          timerStart: 0.3,
          cardFlip: 0.8,
          correctMatch: 0.4,
          wrongMatch: 0.9,
          timerEnd: 0.5,
          endScreen: 0.8,
        };

        /* ===========================================================
       üîπ VARI√ÅVEIS DO JOGO
       =========================================================== */
        const gameGrid = document.getElementById("game-grid");
        const cardImages = [
          "assets/carta1.png",
          "assets/carta2.png",
          "assets/carta3.png",
          "assets/carta4.png",
          "assets/carta5.png",
          "assets/carta6.png",
          "assets/carta7.png",
          "assets/carta8.png",
          "assets/carta9.png",
        ];

        const TOTAL_PARES = cardImages.length; // 9 pares no total

        let cards = [];
        let flippedCards = [];
        let matchedCards = 0;
        let canFlip = false;

        const timeLeftEl = document.getElementById("time-left");
        const timerPathRemaining = document.getElementById("timer-path-remaining");
        const FULL_DASH_ARRAY = 283;
        let timeLeft = CONFIG.TIME_LIMIT;
        let timerAnimationId;
        let startTime;

        // Caminhos para os arquivos de som na pasta assets/sounds
        const AUDIO_PATHS = {
          startScreen: "assets/sounds/start_screen.mp3",
          playButton: "assets/sounds/play_button.mp3",
          timerStart: "assets/sounds/timer_start.mp3",
          cardFlip: "assets/sounds/card_flip.mp3",
          correctMatch: "assets/sounds/correct_match.mp3",
          wrongMatch: "assets/sounds/wrong_match.mp3",
          timerEnd: "assets/sounds/timer_end.mp3",
          endScreen: "assets/sounds/end_screen.mp3",
        };

        let backgroundMusic;
        let timerSound; // Nova vari√°vel para controlar o som do timer
        let endScreenSound; // Nova vari√°vel para controlar o som da tela final

        /* ===========================================================
       üîπ FUN√á√ÉO: Tocar som de efeito
       =========================================================== */
        function playSound(soundPath) {
          const audio = new Audio(soundPath);
          audio.volume = AUDIO_VOLUMES[Object.keys(AUDIO_PATHS).find((key) => AUDIO_PATHS[key] === soundPath)] || CONFIG.VOLUME;
          audio.play().catch((error) => console.error("Erro ao tocar o som:", error));
        }

        /* ===========================================================
       üîπ FUN√á√ÉO: Tocar m√∫sica de fundo
       =========================================================== */
        function playBackgroundMusic() {
          // Pausa o som da tela final antes de come√ßar a tocar a m√∫sica de fundo
          if (endScreenSound) {
            endScreenSound.pause();
            endScreenSound.currentTime = 0;
          }

          if (!backgroundMusic) {
            backgroundMusic = new Audio(AUDIO_PATHS.startScreen);
            backgroundMusic.loop = true; // Define a m√∫sica para tocar em loop
            backgroundMusic.volume = AUDIO_VOLUMES.startScreen;
          }
          backgroundMusic.play().catch((error) => console.error("Erro ao tocar a m√∫sica de fundo:", error));
        }

        function pauseBackgroundMusic() {
          if (backgroundMusic) {
            backgroundMusic.pause();
          }
        }

        // Adiciona uma nova fun√ß√£o para parar o som do timer
        function stopTimerSound() {
          if (timerSound) {
            timerSound.pause();
            timerSound.currentTime = 0;
          }
        }

        /* ===========================================================
       üîπ FUN√á√ÉO: Troca de telas com Fade + Zoom
       =========================================================== */
        function showScreen(screenId) {
          document.querySelectorAll(".page-transition").forEach((el) => {
            el.classList.remove("active");
          });

          const screen = document.getElementById(screenId);

          // For√ßa reflow para resetar anima√ß√£o
          void screen.offsetWidth;

          screen.classList.add("active");
        }

        /* ===========================================================
       üîπ FUN√á√ÉO: Atualiza quantidade de pares
       =========================================================== */
        const updatePares = () => {
          const pares = matchedCards / 2;
          document.getElementById("pares-count").textContent = pares;

          // Checa se todos os pares foram encontrados
          if (pares === TOTAL_PARES) {
            endGame(true); // Fim de jogo com vit√≥ria
          }
        };

        /* ===========================================================
       üîπ FUN√á√ÉO: Embaralhar cartas
       =========================================================== */
        const shuffle = (array) => {
          for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
          }
          return array;
        };

        /* ===========================================================
       üîπ FUN√á√ÉO: Criar tabuleiro
       =========================================================== */
        const createBoard = () => {
          gameGrid.innerHTML = "";
          cards = shuffle([...cardImages, ...cardImages]);
          matchedCards = 0;
          updatePares();

          const frag = document.createDocumentFragment();

          cards.forEach((imageSrc, index) => {
            const cardElement = document.createElement("div");
            cardElement.classList.add("card", "rounded-lg", "shadow-md", "cursor-pointer", "transition-all", "duration-300");
            cardElement.setAttribute("data-index", index);
            cardElement.setAttribute("data-image", imageSrc);
            cardElement.innerHTML = `
          <div class="card-inner w-full h-full">
            <div class="card-front rounded-lg"></div>
            <div class="card-back rounded-lg">
              <img src="${imageSrc}" alt="Frente da Carta" class="w-full h-full object-cover rounded-lg" loading="lazy">
            </div>
          </div>
        `;
            frag.appendChild(cardElement);
          });

          gameGrid.appendChild(frag);
        };

        /* ===========================================================
       üîπ FUN√á√ÉO: Mostrar cartas no in√≠cio
       =========================================================== */
        const previewCards = () => {
          const allCards = document.querySelectorAll(".card");
          allCards.forEach((c) => c.classList.add("flipped"));

          setTimeout(() => {
            allCards.forEach((c) => c.classList.remove("flipped"));
            canFlip = true;
            startTimer();
          }, CONFIG.PREVIEW_DURATION);
        };

        /* ===========================================================
       üîπ FUN√á√ÉO: Clique nas cartas
       =========================================================== */
        gameGrid.addEventListener("click", (event) => {
          if (!canFlip) return;
          const card = event.target.closest(".card");
          if (!card || card.classList.contains("flipped") || card.classList.contains("matched")) return;

          playSound(AUDIO_PATHS.cardFlip);
          flipCard(card);
        });

        const flipCard = (card) => {
          if (!canFlip) return;
          if (card.classList.contains("flipped") || flippedCards.length === 2) return;

          card.classList.add("flipped");
          flippedCards.push(card);

          if (flippedCards.length === 2) {
            canFlip = false;
            setTimeout(checkMatch, 1000);
          }
        };

        const checkMatch = () => {
          const [card1, card2] = flippedCards;
          const image1 = card1.dataset.image;
          const image2 = card2.dataset.image;

          if (image1 === image2) {
            playSound(AUDIO_PATHS.correctMatch);
            card1.classList.add("opacity-50", "cursor-not-allowed", "pointer-events-none", "matched");
            card2.classList.add("opacity-50", "cursor-not-allowed", "pointer-events-none", "matched");
            matchedCards += 2;
            updatePares();
          } else {
            playSound(AUDIO_PATHS.wrongMatch);
            card1.classList.remove("flipped");
            card2.classList.remove("flipped");
          }

          flippedCards = [];
          canFlip = true;
        };

        /* ===========================================================
       üîπ FUN√á√ïES DO TIMER
       =========================================================== */
        function startTimer() {
          // Inicia o som do timer e armazena a refer√™ncia para control√°-lo
          timerSound = new Audio(AUDIO_PATHS.timerStart);
          timerSound.volume = AUDIO_VOLUMES.timerStart;
          timerSound.play().catch((error) => console.error("Erro ao tocar o som do timer:", error));

          startTime = performance.now();
          timerPathRemaining.setAttribute("stroke-dasharray", `${FULL_DASH_ARRAY} ${FULL_DASH_ARRAY}`);
          timerAnimationId = requestAnimationFrame(updateTimer);
        }

        function updateTimer(timestamp) {
          const elapsedTime = (timestamp - startTime) / 1000;
          timeLeft = CONFIG.TIME_LIMIT - elapsedTime;

          if (timeLeft <= 0) {
            timeLeft = 0;
            timeLeftEl.innerText = formatTime(timeLeft);
            setCircleDasharray();
            endGame();
            return;
          }

          timeLeftEl.innerText = formatTime(timeLeft);
          setCircleDasharray();
          timerAnimationId = requestAnimationFrame(updateTimer);
        }

        function formatTime(time) {
          return Math.ceil(time);
        }

        function calculateTimeFraction() {
          return Math.max(0, timeLeft / CONFIG.TIME_LIMIT);
        }

        function setCircleDasharray() {
          const circleDasharray = `${(calculateTimeFraction() * FULL_DASH_ARRAY).toFixed(0)} 283`;
          timerPathRemaining.setAttribute("stroke-dasharray", circleDasharray);

          if (timeLeft <= CONFIG.ALERT_THRESHOLD) {
            timerPathRemaining.setAttribute("stroke", getComputedStyle(document.documentElement).getPropertyValue("--timer-alert"));
          } else if (timeLeft <= CONFIG.WARNING_THRESHOLD) {
            timerPathRemaining.setAttribute("stroke", getComputedStyle(document.documentElement).getPropertyValue("--timer-warning"));
          } else {
            timerPathRemaining.setAttribute("stroke", getComputedStyle(document.documentElement).getPropertyValue("--timer-default"));
          }
        }

        /* ===========================================================
       üîπ FUN√á√ÉO: Encerrar jogo
       =========================================================== */
        function endGame(isWin = false) {
          document.querySelectorAll(".card").forEach((c) => {
            c.style.pointerEvents = "none";
          });
          if (timerAnimationId) cancelAnimationFrame(timerAnimationId);

          // Para o som do timer antes de tocar os outros sons de final de jogo
          stopTimerSound();
          playSound(AUDIO_PATHS.timerEnd);

          const finalMessage = document.getElementById("final-message");
          const pares = matchedCards / 2;
          let message = "";

          if (isWin) {
            message = `Muito bem, voc√™ encontrou <span class="text-6xl text-green-700 font-extrabold">TODOS</span> os pares!`;
          } else if (pares === 0) {
            message = "Mas que pena, voc√™ n√£o encontrou nenhum par.";
          } else if (pares === 1) {
            message = `Voc√™ encontrou <span class="text-7xl text-rose-600 font-extrabold">${pares}</span> par!`;
          } else if (pares >= 1 && pares <= 8) {
            message = `Voc√™ encontrou <span class="text-6xl text-red-700 font-extrabold">${pares}</span> pares!`;
          }

          finalMessage.innerHTML = message;

          // Espera 2 segundos antes de mostrar a tela final e tocar o som
          setTimeout(() => {
            // Armazena a refer√™ncia do som de end screen
            endScreenSound = new Audio(AUDIO_PATHS.endScreen);
            endScreenSound.volume = AUDIO_VOLUMES.endScreen;
            endScreenSound.play().catch((error) => console.error("Erro ao tocar o som de tela final:", error));

            showScreen("final-screen");

            // Ap√≥s a dura√ß√£o da tela final, retorna para a tela inicial e retoma a m√∫sica
            setTimeout(() => {
              showScreen("start-screen");
              playBackgroundMusic();
            }, CONFIG.FINAL_SCREEN_DURATION);
          }, 2000); // 2 segundos
        }

        /* ===========================================================
       üîπ FUN√á√ÉO: Pr√©-carregar imagens
       =========================================================== */
        function preloadImages(list) {
          setTimeout(() => {
            list.forEach((src) => {
              const img = new Image();
              img.src = src;
            });
            new Image().src = "assets/logo.png";
            new Image().src = "/assets/background.png";
          }, 50);
        }

        /* ===========================================================
       üîπ FUN√á√ÉO: Iniciar jogo
       =========================================================== */
        function startGame() {
          // Limpa o grid do jogo e reseta o estado
          gameGrid.innerHTML = "";
          flippedCards = [];
          matchedCards = 0;
          canFlip = false;

          // Reseta o timer para o valor inicial e atualiza a exibi√ß√£o
          timeLeft = CONFIG.TIME_LIMIT;
          timeLeftEl.innerText = formatTime(timeLeft);
          setCircleDasharray();

          pauseBackgroundMusic();
          playSound(AUDIO_PATHS.playButton);
          showScreen("game-wrapper");
          createBoard();
          preloadImages(cardImages);
          previewCards();
        }

        // Toca o som da tela inicial ao carregar
        playBackgroundMusic();

        document.getElementById("start-button").addEventListener("click", startGame);
      });
    </script>
  </body>
</html>
